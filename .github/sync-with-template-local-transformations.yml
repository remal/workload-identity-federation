$schema: https://raw.githubusercontent.com/remal-github-actions/sync-with-template/main/local-transformations.schema.json

repositories:
- remal/workload-identity-federation

transformations:
- name: .github/sync-with-template.yml
  format: yaml
  includes:
  - .github/sync-with-template.yml
  script: |
    content.includes = content.includes ?? []
    ;[
    ].forEach(path => {
      if (!content.includes.includes(path)) {
        content.includes.push(path)
      }
    })
    content.excludes = content.excludes ?? []
    ;[
      '.github/workflows/check-action-secrets.yml',
      '.github/workflows/release-drafter.yml',
      '.github/release-drafter.yml',
    ].forEach(path => {
      if (!content.excludes.includes(path)) {
        content.excludes.push(path)
      }
    })
    return content
- name: mergify
  format: text
  includes:
  - .mergify/config.yml
  script: |
    return content
        .replaceAll(/(`)build\1/g, '$1build-success$1')
        .replaceAll(/(=\s*)build('|\n|$)/g, '$1build-success$2')
